<%- include("../partials/userheader") %>
    <style>
        .retryPaymentBtn {
            font-size: 14px;
            padding: 6px 12px;
            border-radius: 4px;
            background-color: #ffc107;
            color: #212529;
            border: 1px solid #ffc107;
        }

        .retryPaymentBtn:hover {
            background-color: #e0a800;
            border-color: #e0a800;
            color: #212529;
        }

        .retryPaymentBtn:focus {
            box-shadow: 0 0 0 0.2rem rgba(255, 193, 7, 0.5);
        }

        .retryPaymentBtn:active {
            background-color: #b78600;
            border-color: #b78600;
            color: #212529;
        }
    </style>
    <style>
        .card-header {
            font-size: 1.25rem;
            font-weight: bold;
        }

        .table {
            margin-bottom: 0;
        }

        .thead-dark th {
            background-color: #343a40;
            color: white;
        }

        .thead-light th {
            background-color: #f8f9fa;
        }

        .table-hover tbody tr:hover {
            background-color: #f1f1f1;
        }
    </style>
    <style>
        .is-invalid {
            border-color: red;
        }

        .invalid-feedback {
            color: red;
        }
    </style>



    <main class="main">
        <div class="page-header breadcrumb-wrap">
            <div class="container">
                <div class="breadcrumb">
                    <a href="index.html" rel="nofollow">Home</a>
                    <span></span> Pages
                    <span></span> Account
                </div>
            </div>
        </div>
        <section class="pt-75 pb-75">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 m-auto">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="dashboard-menu">
                                    <ul class="nav flex-column" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab"
                                                href="#dashboard" role="tab" aria-controls="dashboard"
                                                aria-selected="false"><i
                                                    class="fi-rs-settings-sliders mr-10"></i>Dashboard</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders"
                                                role="tab" aria-controls="orders" aria-selected="false"><i
                                                    class="fi-rs-shopping-bag mr-10"></i>Orders</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="wallet-tab" data-bs-toggle="tab" href="#wallet"
                                                role="tab" aria-controls="wallet" aria-selected="true">
                                                <i class="fi-rs-user mr-10"></i>Wallet
                                            </a>
                                        </li>

                                        <li class="nav-item">
                                            <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address"
                                                role="tab" aria-controls="address" aria-selected="true"><i
                                                    class="fi-rs-marker mr-10"></i>My Address</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="account-detail-tab" data-bs-toggle="tab"
                                                href="#account-detail" role="tab" aria-controls="account-detail"
                                                aria-selected="true"><i
                                                    class="fi-rs-user mr-10"></i>EditAccountdetails</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" href="/logout"><i
                                                    class="fi-rs-sign-out mr-10"></i>Logout</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-md-9">
                                <div class="tab-content dashboard-content">
                                    <div class="tab-pane fade active show" id="dashboard" role="tabpanel"
                                        aria-labelledby="dashboard-tab">
                                        <div class="tab-pane fade active show" id="dashboard" role="tabpanel"
                                            aria-labelledby="dashboard-tab">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5 class="mb-0">Hello <%= userData.username %>
                                                    </h5>
                                                </div>
                                                <div class="card-body">
                                                    <p>Welcome to your account dashboard. Here are your details:</p>
                                                    <ul>
                                                        <li><strong>Username:</strong>
                                                            <%= userData.username %>
                                                        </li>
                                                        <li><strong>ReferralCode:</strong>
                                                            <%=userData.ReferralCode %>
                                                        </li>
                                                        <li><strong>Email:</strong>
                                                            <%= userData.email %>
                                                        </li>
                                                        <li>
                                                            <strong>Addresses:</strong>
                                                            <ul>
                                                                <% let i=1 %>
                                                                    <% userData.Address.forEach(address=> { %>
                                                                        <li>
                                                                            <%= `${i}.` %>
                                                                                <%= address.houseName %>, <%=
                                                                                        address.street %>, <%=
                                                                                            address.city %>, <%=
                                                                                                address.state %>, <%=
                                                                                                    address.postalCode
                                                                                                    %> (<%=
                                                                                                        address.type==='home'
                                                                                                        ? 'Home'
                                                                                                        : 'Office' %>
                                                                                                        Address)
                                                                                                        <br>
                                                                                                        Mobile Number:
                                                                                                        <%= address.phoneNumber
                                                                                                            %>
                                                                        </li>
                                                                        <br>
                                                                        <% i++; %>
                                                                            <% }); %>
                                                            </ul>

                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    <!--order is placed herer-->
                                    <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                                        <div class="card">
                                            <div class="card-header">
                                                <h5 class="mb-0">Your Orders</h5>
                                            </div>
                                            <div class="card-body">
                                                <% if (orders.length===0) { %>
                                                    <div class="alert alert-info" role="alert">
                                                        Your order history is empty.
                                                    </div>
                                                    <% } else { %>
                                                        <div class="table-responsive"
                                                            style="max-height: 500px; overflow-y: auto;">
                                                            <table class="table" style="border-color: #000;">
                                                                <thead>
                                                                    <tr class="text-center" style="border-color: #000;">
                                                                        <th style="width: 10%; border-color: #000;">Date
                                                                        </th>
                                                                        <th style="width: 10%; border-color: #000;">
                                                                            Status</th>
                                                                        <th style="width: 10%; border-color: #000;">
                                                                            Total</th>
                                                                        <th style="width: 10%; border-color: #000;">
                                                                            ItemCount</th>
                                                                        <th style="width: 1%; border-color: #000;">
                                                                            Product</th>
                                                                        <th style="width: 1%; border-color: #000;">
                                                                            Details</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <% orders.forEach(order=> { %>
                                                                        <% order.items.forEach((item, index)=> { %>
                                                                            <tr class="text-center"
                                                                                style="font-size: xx-small; border-color: #000;">
                                                                                <% if (index===0) { %>
                                                                                    <td rowspan="<%= order.items.length %>"
                                                                                        style="border-color: #000;">
                                                                                        <h5>
                                                                                            <%= order.orderDate.toDateString()
                                                                                                %>
                                                                                        </h5>
                                                                                    </td>
                                                                                    <td rowspan="<%= order.items.length %>"
                                                                                        style="border-color: #000;">
                                                                                        <h5>
                                                                                            <%= order.orderStatus %>
                                                                                        </h5>
                                                                                    </td>
                                                                                    <td rowspan="<%= order.items.length %>"
                                                                                        style="border-color: #000;">
                                                                                        <h5>â‚¹<%= order.billTotal %>
                                                                                        </h5>
                                                                                    </td>
                                                                                    <td rowspan="<%= order.items.length %>"
                                                                                        style="border-color: #000;">
                                                                                        <h5>
                                                                                            <%= order.items.length %>
                                                                                        </h5>
                                                                                    </td>
                                                                                    <% } %>
                                                                                        <td style="border-color: #000;">
                                                                                            <img src="/productimages/<%= item.productId.images[0] %>"
                                                                                                alt="<%= item.productId.name %>"
                                                                                                style="max-height: 100px;">
                                                                                        </td>



                                                                                        <% if (index===0) { %>
                                                                                            <td rowspan="<%= order.items.length %>"
                                                                                                style="border-color: #000;">
                                                                                                <a href="/vieworder/<%= order._id %>"
                                                                                                    class="btn btn-primary viewDetailsBtn"
                                                                                                    style="font-size: x-small;">View</a>
                                                                                            </td>
                                                                                            <% } %>

                                                                            </tr>
                                                                            <% }); %>
                                                                                <% }); %>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                        <% } %>
                                            </div>
                                        </div>
                                    </div>














                                    <div class="tab-pane fade" id="wallet" role="tabpanel" aria-labelledby="wallet-tab">
                                        <div class="container mt-3 mb-3">
                                            <div class="row">
                                                <div class="col-lg-12">
                                                    <div class="card">
                                                        <div class="card-header bg-primary text-white">
                                                            <h4>Wallet Balance</h4>
                                                        </div>
                                                        <div class="card-body">
                                                            <table class="table table-bordered table-hover">
                                                                <thead class="thead-dark">
                                                                    <tr>
                                                                        <th>Balance</th>
                                                                        <th>Amount</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        <td>Current Balance</td>
                                                                        <td>
                                                                            <% if (walletData &&
                                                                                walletData.walletBalance===0) { %>
                                                                                Wallet Balance is 0
                                                                                <% } else if (walletData &&
                                                                                    walletData.walletBalance) { %>
                                                                                    <%= walletData.walletBalance %>
                                                                                        <% } else { %>
                                                                                            No wallet data available
                                                                                            <% } %>
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mt-4">
                                                <div class="col-lg-12">
                                                    <div class="card">
                                                        <div class="card-header bg-success text-white">
                                                            <h4>Transaction History</h4>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="table-responsive"
                                                                style="max-height: 300px; overflow-y: auto;">
                                                                <% if (walletData && walletData.transactions &&
                                                                    walletData.transactions.length> 0) { %>
                                                                    <table class="table table-bordered table-hover">
                                                                        <thead class="thead-light">
                                                                            <tr>
                                                                                <th>Date</th>
                                                                                <th>Description</th>
                                                                                <th>Type</th>
                                                                                <th>Amount</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <%
                                                                                walletData.transactions.forEach(transaction=>
                                                                                { %>
                                                                                <tr>
                                                                                    <td>
                                                                                        <%= transaction.transactionDate.toLocaleDateString()
                                                                                            %>
                                                                                    </td>
                                                                                    <td>
                                                                                        <%= transaction.description %>
                                                                                    </td>
                                                                                    <td>
                                                                                        <%= transaction.type %>
                                                                                    </td>
                                                                                    <td>
                                                                                        <%= transaction.amount %>
                                                                                    </td>
                                                                                </tr>
                                                                                <% }) %>
                                                                        </tbody>
                                                                    </table>
                                                                    <% } else { %>
                                                                        <p>No transaction data available.</p>
                                                                        <% } %>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>









                                    <div class="tab-pane fade" id="address" role="tabpanel"
                                        aria-labelledby="address-tab">
                                        <div class="container mt-3 mb-3">
                                            <div class="row">
                                                <div class="col-lg-12 d-flex justify-content-end">
                                                    <button type="button" class="btn btn-primary btn-sm"
                                                        data-bs-toggle="modal" data-bs-target="#addAddressModal">Add
                                                        Address</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <% userData.Address.forEach(address=> { %>
                                                <div class="col-lg-6">
                                                    <div class="card">
                                                        <div class="card-header">
                                                            <h5 class="mb-0">Address</h5>
                                                        </div>
                                                        <div class="card-body">
                                                            <address>
                                                                <%= address.houseName %><br>
                                                                    <%= address.street %>,<br>
                                                                        <%= address.city %>, <%= address.state %>
                                                                                <%= address.postalCode %><br>
                                                                                    <%= address.country %><br>
                                                                                        Phone: <%= address.phoneNumber
                                                                                            %><br>
                                                                                            Type: <%= address.type %>
                                                            </address>
                                                            <a href="#" class="btn btn-primary btn-sm"
                                                                data-bs-toggle="modal"
                                                                data-bs-target="#editAddressModal<%= address._id %>">Edit</a>
                                                            <a href="#" class="btn btn-danger btn-sm"
                                                                data-bs-toggle="modal"
                                                                data-bs-target="#deleteAddressModal<%= address._id %>">Delete</a>
                                                        </div>
                                                    </div>
                                                </div>
                                                <% }); %>
                                        </div>


                                    </div>


                                    <!-- Modal -->

                                    <div class="modal fade" id="addAddressModal" tabindex="-1"
                                        aria-labelledby="addAddressModalLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="addAddressModalLabel">Add Address</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                        aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <form id="addAddressForm">
                                                        <div class="mb-3">
                                                            <label for="houseName" class="form-label">House Name</label>
                                                            <input type="text" class="form-control" id="houseName"
                                                                placeholder="Enter house name" required>
                                                            <div class="invalid-feedback">Please enter a valid house
                                                                name.</div>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="street" class="form-label">Street</label>
                                                            <input type="text" class="form-control" id="street"
                                                                placeholder="Enter street" required>
                                                            <div class="invalid-feedback">Please enter a valid street.
                                                            </div>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="city" class="form-label">City</label>
                                                            <input type="text" class="form-control" id="city"
                                                                placeholder="Enter city" required>
                                                            <div class="invalid-feedback">Please enter a valid city.
                                                            </div>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="state" class="form-label">State</label>
                                                            <input type="text" class="form-control" id="state"
                                                                placeholder="Enter state" required>
                                                            <div class="invalid-feedback">Please enter a valid state.
                                                            </div>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="postalCode" class="form-label">Postal
                                                                Code</label>
                                                            <input type="text" class="form-control" id="postalCode"
                                                                placeholder="Enter postal code" required>
                                                            <div class="invalid-feedback">Please enter a valid postal
                                                                code.</div>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="country" class="form-label">Country</label>
                                                            <input type="text" class="form-control" id="country"
                                                                placeholder="Enter country" required>
                                                            <div class="invalid-feedback">Please enter a valid country.
                                                            </div>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="phoneNumber" class="form-label">Phone
                                                                Number</label>
                                                            <input type="text" class="form-control" id="phoneNumber"
                                                                placeholder="Enter phone number" required>
                                                            <div class="invalid-feedback">Please enter a valid phone
                                                                number.</div>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label for="type" class="form-label">Address Type</label>
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="radio" name="type"
                                                                    id="homeAddress" value="home" checked>
                                                                <label class="form-check-label"
                                                                    for="homeAddress">Home</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input" type="radio" name="type"
                                                                    id="officeAddress" value="office">
                                                                <label class="form-check-label"
                                                                    for="officeAddress">Office</label>
                                                            </div>
                                                        </div>
                                                        <button type="button" class="btn btn-primary"
                                                            id="saveAddressBtn">Save Address</button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Edit Address Modal -->
                                    <% userData.Address.forEach(address=> { %>
                                        <div class="modal fade" id="editAddressModal<%= address._id %>" tabindex="-1"
                                            aria-labelledby="editAddressModalLabel<%= address._id %>"
                                            aria-hidden="true">
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title"
                                                            id="editAddressModalLabel<%= address._id %>">Edit Address
                                                        </h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                            aria-label="Close"></button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <form id="editAddressForm<%= address._id %>">
                                                            <div class="mb-3">
                                                                <label for="editHouseName<%= address._id %>"
                                                                    class="form-label">House Name</label>
                                                                <input type="text" class="form-control"
                                                                    id="editHouseName<%= address._id %>"
                                                                    value="<%= address.houseName %>" required>
                                                            </div>
                                                            <div class="mb-3">
                                                                <label for="editStreet<%= address._id %>"
                                                                    class="form-label">Street</label>
                                                                <input type="text" class="form-control"
                                                                    id="editStreet<%= address._id %>"
                                                                    value="<%= address.street %>" required>
                                                            </div>
                                                            <div class="mb-3">
                                                                <label for="editCity<%= address._id %>"
                                                                    class="form-label">City</label>
                                                                <input type="text" class="form-control"
                                                                    id="editCity<%= address._id %>"
                                                                    value="<%= address.city %>" required>
                                                            </div>
                                                            <div class="mb-3">
                                                                <label for="editState<%= address._id %>"
                                                                    class="form-label">State</label>
                                                                <input type="text" class="form-control"
                                                                    id="editState<%= address._id %>"
                                                                    value="<%= address.state %>" required>
                                                            </div>
                                                            <div class="mb-3">
                                                                <label for="editPostalCode<%= address._id %>"
                                                                    class="form-label">Postal Code</label>
                                                                <input type="text" class="form-control"
                                                                    id="editPostalCode<%= address._id %>"
                                                                    value="<%= address.postalCode %>" required>
                                                            </div>
                                                            <div class="mb-3">
                                                                <label for="editCountry<%= address._id %>"
                                                                    class="form-label">Country</label>
                                                                <input type="text" class="form-control"
                                                                    id="editCountry<%= address._id %>"
                                                                    value="<%= address.country %>" required>
                                                            </div>
                                                            <div class="mb-3">
                                                                <label for="editPhoneNumber<%= address._id %>"
                                                                    class="form-label">Phone Number</label>
                                                                <input type="text" class="form-control"
                                                                    id="editPhoneNumber<%= address._id %>"
                                                                    value="<%= address.phoneNumber %>" required>
                                                            </div>
                                                            <div class="mb-3">
                                                                <label for="editAddressType<%= address._id %>"
                                                                    class="form-label">Address Type</label>
                                                                <select class="form-select"
                                                                    id="editAddressType<%= address._id %>" required>
                                                                    <option value="home" <% if
                                                                        (address.addressType==='home' ) { %> selected <%
                                                                            } %>>Home</option>
                                                                    <option value="office" <% if
                                                                        (address.addressType==='office' ) { %> selected
                                                                        <% } %>>Office
                                                                    </option>
                                                                </select>
                                                            </div>
                                                        </form>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary"
                                                            data-bs-dismiss="modal">Close</button>
                                                        <button type="button" class="btn btn-primary"
                                                            onclick="submitEditAddressForm('<%= address._id %>')">Save
                                                            Changes</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <% }); %>
                                            <!-- End Edit Address Modal -->

                                            <!--  Delete Address Modal -->
                                            <% userData.Address.forEach(address=> { %>
                                                <div class="modal fade" id="deleteAddressModal<%= address._id %>"
                                                    tabindex="-1"
                                                    aria-labelledby="deleteAddressModalLabel<%= address._id %>"
                                                    aria-hidden="true">
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title"
                                                                    id="deleteAddressModalLabel<%= address._id %>">
                                                                    Delete Address</h5>
                                                                <button type="button" class="btn-close"
                                                                    data-bs-dismiss="modal" aria-label="Close"></button>
                                                            </div>
                                                            <div class="modal-body">
                                                                <p>Are you sure you want to delete this address?</p>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary"
                                                                    data-bs-dismiss="modal">Cancel</button>
                                                                <button type="button" class="btn btn-danger"
                                                                    onclick="deleteAddress('<%= address._id %>')">Delete</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <% }); %>

                                                    <!-- End Delete Address Modal -->



                                                    <div class="tab-pane fade" id="account-detail" role="tabpanel"
                                                        aria-labelledby="account-detail-tab">

                                                        <!-- Username and Email Form -->
                                                        <div class="card mb-3">
                                                            <div class="card-header">
                                                                <h5>Edit Username and Email</h5>
                                                            </div>
                                                            <div class="card-body">
                                                                <form method="post" name="usernameEmailForm"
                                                                    id="usernameEmailForm">
                                                                    <div class="form-group">
                                                                        <label for="username">Username</label>
                                                                        <input required="" id="username"
                                                                            class="form-control square" name="uname"
                                                                            value="<%=username%>" type="text">
                                                                        <div id="usernameError" class="error-message">
                                                                        </div> <!-- Error message container -->
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label for="email">Email Address <span
                                                                                class="required">*</span></label>
                                                                        <input required="" id="email"
                                                                            class="form-control square" name="email"
                                                                            value="<%=email%>" type="email">
                                                                        <div id="emailError" class="error-message">
                                                                        </div> <!-- Error message container -->
                                                                    </div>
                                                                    <button type="button" id="updateUsernameEmailBtn"
                                                                        class="btn btn-fill-out submit">Save</button>
                                                                </form>
                                                            </div>
                                                        </div>

                                                        <!-- Password Form -->
                                                        <div class="card">
                                                            <div class="card-header">
                                                                <h5>Edit Password</h5>
                                                            </div>
                                                            <div class="card-body">
                                                                <form method="post" name="passwordForm"
                                                                    id="passwordForm">
                                                                    <div class="form-group">
                                                                        <label>Current Password <span
                                                                                class="required">*</span></label>
                                                                        <input required="" class="form-control square"
                                                                            id="currentPassword" type="password">
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label>New Password <span
                                                                                class="required">*</span></label>
                                                                        <input required="" class="form-control square"
                                                                            id="newPassword" type="password">
                                                                    </div>
                                                                    <div class="form-group">
                                                                        <label>Confirm Password <span
                                                                                class="required">*</span></label>
                                                                        <input required="" class="form-control square"
                                                                            id="confirmPassword" type="password">
                                                                        <div id="passwordMismatchError"
                                                                            class="error-message"></div>
                                                                        <!-- Error message container -->
                                                                    </div>
                                                                    <button type="submit" id="savePasswordBtn"
                                                                        class="btn btn-fill-out submit" name="submit"
                                                                        value="Submit">Save</button>
                                                                </form>
                                                            </div>
                                                        </div>


                                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        </section>
    </main>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        function handleRetryPayment(orderId) {
            const cancelForm = document.getElementById(`cancelForm_${orderId}`);
            const retryBtn = document.getElementById(`retryBtn_${orderId}`);
            const cancelMsg = document.getElementById(`cancelMsg_${orderId}`);

            // Hide the retry button and show the cancel message
            retryBtn.style.display = 'none';
            cancelMsg.style.display = 'block';

            // Submit the cancel form
            cancelForm.submit();
        }
    </script>


    //
    <script>

        //     document.getElementById('saveAddressBtn').addEventListener('click', function () {

        //         const houseName = document.getElementById('houseName').value;
        //         const street = document.getElementById('street').value;
        //         const city = document.getElementById('city').value;
        //         const state = document.getElementById('state').value;
        //         const postalCode = document.getElementById('postalCode').value;
        //         const country = document.getElementById('country').value;
        //         const phoneNumber = document.getElementById('phoneNumber').value;
        //         const type = document.querySelector('input[name="type"]:checked').value;


        //         const addressData = {
        //             houseName: houseName,
        //             street: street,
        //             city: city,
        //             state: state,
        //             postalCode: postalCode,
        //             country: country,
        //             phoneNumber: phoneNumber,
        //             type: type
        //         };


        //         fetch('/profile/addAddress', {
        //             method: 'POST',
        //             headers: {
        //                 'Content-Type': 'application/json'
        //             },
        //             body: JSON.stringify(addressData)
        //         })
        //             .then(response => response.json())
        //             .then(data => {
        //                 console.log(data);
        //                 $('#addAddressModal').modal('hide');
        //                 window.location.reload();

        //             })
        //             .catch(error => {
        //                 console.error('Error:', error);
        //             });
        //     });

        // </script>
    // <script>
    //     document.getElementById('saveAddressBtn').addEventListener('click', function () {
    //         const form = document.getElementById('addAddressForm');
    //         const formInputs = form.querySelectorAll('input:not([type="radio"])');
    //         console.log(form, 'form is coming');
    //         console.log(formInputs, 'forminput is coming');

    //         let isValid = true;

    //         formInputs.forEach(input => {
    //             if (!input.value || (input.id === 'phoneNumber' && !/^\d+$/.test(input.value)) || (input.id === 'postalCode' && !/^\d+$/.test(input.value))) {
    //                 input.classList.add('is-invalid');
    //                 isValid = false;
    //             } else {
    //                 input.classList.remove('is-invalid');
    //             }
    //         });

    //         if (!isValid) return;

    //         const houseName = document.getElementById('houseName').value;
    //         const street = document.getElementById('street').value;
    //         const city = document.getElementById('city').value;
    //         const state = document.getElementById('state').value;
    //         const postalCode = document.getElementById('postalCode').value;
    //         const country = document.getElementById('country').value;
    //         const phoneNumber = document.getElementById('phoneNumber').value;
    //         const type = document.querySelector('input[name="type"]:checked').value;

    //         const addressData = {
    //             houseName,
    //             street,
    //             city,
    //             state,
    //             postalCode,
    //             country,
    //             phoneNumber,
    //             type,
    //         };

    //         console.log(addressData, 'address data is coming');

    //         fetch('/profile/addAddress', {
    //             method: 'POST',
    //             headers: {
    //                 'Content-Type': 'application/json',
    //             },
    //             body: JSON.stringify(addressData),
    //         })
    //             .then(response => response.json())
    //             .then(data => {
    //                 console.log(data);
    //                 $('#addAddressModal').modal('hide');
    //                 window.location.reload();
    //             })
    //             .catch(error => {
    //                 console.error('Error:', error);
    //             });
    //     });
    // </script>
    <script>
    document.getElementById('saveAddressBtn').addEventListener('click', function () {
    const form = document.getElementById('addAddressForm');
    const formInputs = form.querySelectorAll('input:not([type="radio"])');

    let isValid = true;

    formInputs.forEach(input => {
        let value = input.value.trim();
        let isValidInput = true;

        if (!value) {
            isValidInput = false;
        } else if (input.id === 'phoneNumber') {
            isValidInput = /^\d+{10}$/.test(value);
        } else if (input.id === 'postalCode') {
            isValidInput = /^\d{6}$/.test(value);
        } else if (input.id === 'houseName' || input.id === 'street' || input.id === 'city' || input.id === 'state' || input.id === 'country') {
            isValidInput = /^[a-zA-Z\s]+$/.test(value);
        }

        if (!isValidInput) {
            input.classList.add('is-invalid');
            isValid = false;
        } else {
            input.classList.remove('is-invalid');
        }
    });

    if (!isValid) return;

    const addressData = {
        houseName: document.getElementById('houseName').value.trim(),
        street: document.getElementById('street').value.trim(),
        city: document.getElementById('city').value.trim(),
        state: document.getElementById('state').value.trim(),
        postalCode: document.getElementById('postalCode').value.trim(),
        country: document.getElementById('country').value.trim(),
        phoneNumber: document.getElementById('phoneNumber').value.trim(),
        type: document.querySelector('input[name="type"]:checked').value
    };

    fetch('/profile/addAddress', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(addressData),
    })
        .then(response => response.json())
        .then(data => {
            console.log(data);
            $('#addAddressModal').modal('hide');
            window.location.reload();
        })
        .catch(error => {
            console.error('Error:', error);
        });
});
</script>
    <script>
        function submitEditAddressForm(addressId) {
            console.log(addressId, "testing")
            // Get form data
            const houseName = document.getElementById(`editHouseName${addressId}`).value;
            const street = document.getElementById(`editStreet${addressId}`).value;
            const city = document.getElementById(`editCity${addressId}`).value;
            const state = document.getElementById(`editState${addressId}`).value;
            const postalCode = document.getElementById(`editPostalCode${addressId}`).value;
            const country = document.getElementById(`editCountry${addressId}`).value;
            const phoneNumber = document.getElementById(`editPhoneNumber${addressId}`).value;
            const addressType = document.getElementById(`editAddressType${addressId}`).value;


            const formData = {
                houseName: houseName,
                street: street,
                city: city,
                state: state,
                postalCode: postalCode,
                country: country,
                phoneNumber: phoneNumber,
                addressType: addressType
            };


            fetch(`/profile/editAddress/${addressId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData),
            })
                .then(response => response.json())
                .then(data => {

                    console.log('Address updated successfully:', data);
                    window.location.reload();
                    $(`#editAddressModal${addressId}`).modal('hide');


                })
                .catch(error => {
                    console.error('Error updating address:', error);

                });
        }
    </script>

    <script>
        function deleteAddress(addressId) {
            // Send a DELETE request using fetch API
            fetch(`/profile/deleteAddress/${addressId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {

                    console.log(data);
                    window.location.reload();
                })
                .catch(error => {

                    console.error('There was a problem with your fetch operation:', error);
                });
        }
    </script>

    <script>
        document.getElementById('updateUsernameEmailBtn').addEventListener('click', function () {
            const username = document.getElementById('username').value.trim();
            const email = document.getElementById('email').value.trim();
            const usernameError = document.getElementById('usernameError');
            const emailError = document.getElementById('emailError');

            if (!username) {
                usernameError.textContent = 'Please enter the new username.';
                return;
            } else {
                usernameError.textContent = '';
            }

            if (!email) {
                emailError.textContent = 'Please enter the new email address.';
                return;
            } else {
                emailError.textContent = '';
            }

            const userData = {
                username: username,
                email: email
            };

            fetch('/profile/updateUsernameEmail', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userData)
            })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    window.location.reload();
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });
    </script>




    <script>
        document.getElementById('passwordForm').addEventListener('submit', function (event) {
            event.preventDefault();
            const currentPassword = document.getElementById('currentPassword').value.trim();
            const newPassword = document.getElementById('newPassword').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();
            const passwordMismatchError = document.getElementById('passwordMismatchError');
            passwordMismatchError.textContent = '';

            if (!currentPassword || !newPassword || !confirmPassword) {
                passwordMismatchError.textContent = 'Please fill in all required fields.';
                return;
            }

            if (newPassword !== confirmPassword) {
                passwordMismatchError.textContent = 'New password and confirm password do not match.';
                return;
            }

            const passwordData = {
                currentPassword: currentPassword,
                newPassword: newPassword
            };

            fetch('/profile/changePassword', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(passwordData)
            })
                .then(response => response.json())
                .then(data => {
                    if (data.message === 'Current password is incorrect') {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: 'Current password is incorrect',
                        });
                    } else if (data.message === 'Password updated successfully') {
                        Swal.fire({
                            icon: 'success',
                            title: 'Success',
                            text: 'Password updated successfully',
                        });
                        // window.location.reload();
                    } else {
                        console.error('Unexpected response:', data);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });
    </script>



    <%- include("../partials/userfooter") %>